<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>Home Assistant Google Drive Backup</title>

  <link href="static/css/icons.css?version=0.100.0" rel="stylesheet">
  <link href="static/css/materialize.css?version=0.100.0" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="static/css/colpick.css?version=0.100.0" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="theme?version=0.100.0" id="theme" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="static/css/static.css?version=0.100.0" type="text/css" rel="stylesheet" media="screen,projection" />
  <link rel="icon" type="image/png" href="static/images/favicon.png?version=0.100.0">
  <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
  <script src="static/js/jquery.js?version=0.100.0"></script>
  <script src="static/js/markdown-it.min.js?version=0.100.0"></script>
  <script src="static/js/clipboard.min.js?version=0.100.0"></script>
  <script src="static/js/materialize.js?version=0.100.0"></script>
  <script src="static/js/colpick.js?version=0.100.0"></script>
  <script src="static/js/init.js?version=0.100.0"></script>
  <script src="static/js/scripts.js?version=0.100.0"></script>
  <script src="static/js/settings.js?version=0.100.0"></script>
  <script src="static/js/restore.js?version=0.100.0"></script>
  <script src="static/js/moment.js?version=0.100.0"></script>
</head>

<body>
  <div id="settings_modal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Add-on Settings</h4>
      <p>Settings take effect right after saving them. If you enable or disable SSL, you may need to go to a different
        address to access the UI after the settings are saved. See the <a
          href="https://github.com/sabeechen/hassio-google-drive-backup#configuration-options" target="_blank">GitHub
          Readme</a> for more help with settings.</p>
      <div class="row">
        <form class="col s12" method="get" id="settings_form">
          <div class="row">
            <div class="input-field col m6 s12">
              <i class="material-icons prefix">computer</i>
              <input type="number" id="max_snapshots_in_hassio" name="max_snapshots_in_hassio" min="0"
                class="validate" />
              <label for="max_snapshots_in_hassio">Snapshots in Home Assistant</label>
              <span class="helper-text">The maximum number of snapshots to keep locally in Home Assistant, or 0 to
                disable cleanup of old snapshots entirely.</span>
            </div>
            <div class="input-field col m6 s12">
              <i class="material-icons prefix">cloud_upload</i>
              <input type="number" id="max_snapshots_in_google_drive" name="max_snapshots_in_google_drive" min="0"
                class="validate" />
              <label for="max_snapshots_in_google_drive">Snapshots in Google Drive</label>
              <span class="helper-text">The maximum number of snapshots to keep remotely in Google Drive, or 0 to
                disable cleanup of old snapshots entirely.</span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col m6 s12">
              <i class="material-icons prefix">date_range</i>
              <input type="number" id="days_between_snapshots" name="days_between_snapshots" min="0" class="validate" />
              <label for="days_between_snapshots">Days between snapshots</label>
              <span class="helper-text">The number of days between snapshots, or 0 to disable automatic snapshot
                creation.</span>
            </div>
            <div class="input-field col m6 s12">
              <i class="material-icons prefix">alarm_on</i>
              <input type="text" id="snapshot_time_of_day" name="snapshot_time_of_day" pattern="^[0-2]\d:[0-5]\d$"
                class="validate" />
              <label for="snapshot_time_of_day">Snapshot time of day</label>
              <span class="helper-text">The time of day when snapshots should be taken in the form 'HH:mm' (24 hour
                clock).</span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col m6 s12">
              <i class="material-icons prefix">vpn_key</i>
              <input type="password" autocomplete="new-password" id="snapshot_password" name="snapshot_password"
                class="validate" onkeyup="checkForSecret()" />
              <label for="snapshot_password">Password</label>
              <span class="helper-text">When set, creates snapshots protected by a password. This password will be
                required by Home Assistant when restoring the snapshot. Leave blank to require no password. You can specify a
                password from your secrets.yaml by using the syntax "!secret your_secret_key".</span>
            </div>
            <div class="input-field col m6 s12" id="password_renter_block">
              <i class="material-icons prefix">vpn_key</i>
              <input type="password" autocomplete="new-password" id="snapshot_password_reenter"
                name="snapshot_password_reenter" settings_ignore='true' class="validate" onkeyup="checkForSecret()" />
              <label for="snapshot_password_reenter">Re-enter password</label>
              <span class="helper-text">Re-enter your new password to ensure it matches.</span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <i class="material-icons prefix">label_outline</i>
              <input type="text" id="snapshot_name" name="snapshot_name" class="validate"
                onkeyup="snapshotNameExample()" />
              <label for="snapshot_name">Snapshot Name Template</label>
              <span class="helper-text">The template to use for naming new snapshot. <a target="_blank"
                  href="https://github.com/sabeechen/hassio-google-drive-backup#can-i-give-snapshots-a-different-name">See
                  here</a> for a list of all
                available options, your snapshots names will look something like: <br /><span
                  id="snapshot_example"></span>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <input type="checkbox" name="specify_snapshot_folder" id="specify_snapshot_folder"
                  class="filled-in checkbox-ha" onchange="chooseFolderChanged();" />
                <span>Manually specify the snapshot folder</span>
                <br />
                <span class="helper-text">Specify manually which folder snapshots should be uploaded into in Google
                  Drive. <span class="hide-for-custom-creds">Once this setting is saved,
                    you'll be prompted to select a folder from your Google Drive.</span> If disabled, the addon will
                  automatically create a folder in your My Drive
                  whenever its needed.</span><span id="current_folder_span"><a id=current_folder_link target="_blank">
                    Click here</a> to see the folder currently being used.</span>
              </label>
              <br />
              <div id="choose_folder_controls">
                <div class="hide-for-custom-creds">
                  <a href="#!" id="choose_folder_button" onclick="chooseSnapshotFolder()"
                    class="waves-effect waves-light btn-flat ha-blue" id="save_settings"
                    style="margin-left: 20px; margin-top: 10px;">Choose Folder</a> <span
                    class="hide-for-custom-creds helper-text" style="vertical-align: middle;"> Note: This link takes you
                    to an external domain.</span>
                </div>
                <div class="hide-for-default-creds">
                  <div class="input-field col s11 offset-s1">
                    <i class="material-icons prefix">folder_open</i>
                    <input type="text" settings_ignore='true' id="settings_specify_folder_id"
                      name="settings_specify_folder_id" class="validate" />
                    <label for="settings_specify_folder_id">Snapshot Folder ID</label>
                    <span class="helper-text">The Google Drive ID of the folder you'd like to upload snapshots into. You
                      can get this id by navigating to the folder in <a href="https://drive.google.com">Google Drive</a>
                      and copying it out of the URL. It should be a long sequence of characters at the end of the URL.
                      For example if the URL for my folder is
                      <a target="_blank"
                        href="https://drive.google.com/drive/folders/1el4ZWcE0xdkIu_Yt_2kxk36qE7K5O188">https://drive.google.com/drive/folders/1el4ZWcE0xdkIu_Yt_2kxk36qE7K5O188</a>,
                      then the Drive ID is
                      1el4ZWcE0xdkIu_Yt_2kxk36qE7K5O188</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="notify_for_stale_snapshots" id="notify_for_stale_snapshots"
                  class="filled-in checkbox-ha" />
                <span>Enable Staleness Notifications</span>
                <br />
                <span class="helper-text">When there is a problem with the snapshots, show a persistant notification in
                  the Home Assistant interface.</span>
              </label>
            </div>
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="enable_snapshot_stale_sensor" id="enable_snapshot_stale_sensor"
                  class="filled-in checkbox-ha" />
                <span>Enable Snapshot Stale Sensor</span>
                <br />
                <span class="helper-text">Publishes a sensor, binary_sensor.snapshots_stale, indicating if there is a
                  problem backing up or creating snapshots.</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="enable_snapshot_state_sensor" id="enable_snapshot_state_sensor"
                  class="filled-in checkbox-ha" />
                <span>Enable Snapshot State Sensor</span>
                <br />
                <span class="helper-text">Publishes a sensor, sensor.snapshot_state, with the status of existing
                  snapshots.</span>
              </label>
            </div>
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="send_error_reports" id="send_error_reports"
                  class="filled-in checkbox-ha" />
                <span>Send Error Reports</span>
                <br />
                <span class="helper-text">Sends information about errors to a database maintained by developer. This
                  helps him identify problems with new releases and provide better help messages.</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="confirm_multiple_deletes" id="confirm_multiple_deletes"
                  class="filled-in checkbox-ha" />
                <span>Confirm before large deletes</span>
                <br />
                <span class="helper-text">When disabled, the add-on will NOT stop and ask for confirmation before
                  deleting more than one snapshot. Disabling this is dangerous because accidental misconfiguration can
                  cause you to lose your backed-up snapshot history.</span>
              </label>
            </div>
            <div class="col m6 s12">
              <label>
                <input type="checkbox" name="enable_drive_upload" id="enable_drive_upload"
                  class="filled-in checkbox-ha" />
                <span>Enable Google Drive Upload</span>
                <br />
                <span class="helper-text">When disabled, new snapshots will still be created in Home Assistant but will
                  not be uploaded to Google Drive.</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <input type="checkbox" name="warn_for_low_space" id="warn_for_low_space"
                  class="filled-in checkbox-ha" />
                <span>Stop on low disk space</span>
                <br />
                <span class="helper-text">When enabled, the addon will stop creating snapshots and ask for you to take
                  action it thinks you don't have enough disk space. Disabling this is not recommended because
                  recovering from an exhausted disk can be very difficult.</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <input type="checkbox" name="expose_extra_server" id="expose_extra_server" class="filled-in checkbox-ha"
                  onchange="toggleSlide(this, 'settings_server_details');" />
                <span id="expose_extra_server_label">Expose this web interface on an additional port</span>
                <br />
                <span class="helper-text" id="expose_extra_server_help">Expose this web interface on an additional port.
                  This isn't necessary unless you'd like to avoid accessing this web interface through <a
                    target="_blank"
                    href="https://www.home-assistant.io/blog/2019/04/15/hassio-ingress/">ingress</a>.</span>
              </label>
            </div>
          </div>
          <div class="row" id="settings_server_details" style="display: none">
            <div class="col s11 offset-s1">
              <label>
                <span class="helper-text">Use the options below to configure what kind of SSL and and authentication
                  you'd like to use for this webpage. By default this server is exposed on port 1627, but that can be
                  changed from the add-on installation page.</span>
              </label>
            </div>
            <div class="col s11 offset-s1">
              <div class="row">
                <div class="col s12">
                  <label>
                    <input type="checkbox" name="require_login" id="require_login" class="filled-in checkbox-ha" />
                    <span>Require Login</span>
                    <br />
                    <span class="helper-text">Makes you enter your Home Assistant credentials to login to this
                      webpage.</span>
                  </label>
                </div>
              </div>
              <div class="row">
                <div class="col s12">
                  <label>
                    <input type="checkbox" name="use_ssl" id="use_ssl" class="filled-in checkbox-ha"
                      onchange="toggleSlide(this, 'settings_ssl_details');" />
                    <span>Use SSL</span>
                    <br />
                    <span class="helper-text">Require SSL to access this web interface. You must already have SSL keys
                      configured to use this. Note that once this setting is changed, you'll need to navigate to the
                      new url
                      to continue using this webpage.</span>
                  </label>
                </div>
                <div class=" col s12 offset-s1 row" id="settings_ssl_details" style="display: none">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">vpn_key</i>
                    <input type="text" id="certfile" name="certfile" class="validate" />
                    <label for="certfile">Certificate File</label>
                    <span class="helper-text">The path to your certificate file. If you use the default Let's
                      Encrypt settings, the default should be correct.</span>
                  </div>
                  <div class="input-field col s12">
                    <i class="material-icons prefix">vpn_key</i>
                    <input type="text" id="keyfile" name="keyfile" class="validate" />
                    <label for="keyfile">Key File</label>
                    <span class="helper-text">The path to your key file. If you use the default Let's Encrypt
                      settings, the default should be correct.</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <input type="checkbox" settings_ignore='true' id="generational_enabled" name="generational_enabled"
                  class="filled-in checkbox-ha" onchange="toggleSlide(this, 'settings_gen_details');" />
                <span>Keep Generational Backups</span>
                <br />
                <span class="helper-text">Keeps older snapshots longer on daily, weekly, monthly, and yearly rotations
                  instead of just
                  deleting the oldest snapshots. When using this feature, its recommended that you keep "Days
                  Between Snapshots" at 1. <a
                    href="https://github.com/sabeechen/hassio-google-drive-backup/blob/master/hassio-google-drive-backup/GENERATIONAL_BACKUP.md"
                    target="_blank">See here</a> for a deeper explanation.</span>
              </label>
            </div>
            <div class="row" id="settings_gen_details" style="display: none">
              <div class="col s11 offset-s1">
                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">date_range</i>
                    <input type="number" id="generational_days" name="generational_days" min="0" class="validate" />
                    <label for="generational_days">Days</label>
                    <span class="helper-text">The number of daily snapshots to keep.</span>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">date_range</i>
                    <input type="number" id="generational_weeks" name="generational_weeks" min="0" class="validate" />
                    <label for="generational_weeks">Weeks</label>
                    <span class="helper-text">The number of weeks of snapshots to keep.</span>
                  </div>
                  <div class="input-field col m6 s12">
                    <select class="browser-default" name="generational_day_of_week" id="generational_day_of_week">
                      <option value="mon" selected>Monday</option>
                      <option value="tue">Tuesday</option>
                      <option value="wed">Wednesday</option>
                      <option value="thu">Thursday</option>
                      <option value="fri">Friday</option>
                      <option value="sat">Saturday</option>
                      <option value="sun">Sunday</option>
                    </select>
                    <label class="helper-text">The day of the week when weekly snapshots will be kept.</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">date_range</i>
                    <input type="number" id="generational_months" name="generational_months" min="0" class="validate" />
                    <label for="generational_months">Months</label>
                    <span class="helper-text">The number of months of snapshots to keep.</span>
                  </div>
                  <div class="input-field col m6 s12">
                    <input type="number" id="generational_day_of_month" value=1 name="generational_day_of_month" min="1"
                      max="31" class="validate" />
                    <label for="generational_day_of_month">Day of Month</label>
                    <span class="helper-text">The day of the month to keep monthly snapshots, from 1 to 31</span>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">date_range</i>
                    <input type="number" id="generational_years" name="generational_years" min="0" class="validate" />
                    <label for="generational_years">Years</label>
                    <span class="helper-text">The number of years of snapshots to keep.</span>
                  </div>
                  <div class="input-field col m6 s12">
                    <input type="number" id="generational_day_of_year" value=1 name="generational_day_of_year" min="1"
                      max="365" class="validate" />
                    <label for="generational_day_of_year">Day of Year</label>
                    <span class="helper-text">The day of the year to keep yearly snapshots, from 1 to 365</span>
                  </div>
                </div>
                <div class="row">
                  <div class="col s12">
                    <label>
                      <input type="checkbox" id="generational_delete_early" name="generational_delete_early"
                        class="filled-in checkbox-ha" />
                      <span>Purge Old Snapshots Early</span>
                      <br />
                      <span class="helper-text">When checked, old snapshots that aren't part of any daily, weekly,
                        monthly, or yearly cycle you've configured will be deleted even if you haven't reached the
                        configured maxium number of snapshots in Google Drive/Home Assistant.</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <input type="checkbox" settings_ignore="true" name="partial_snapshots" id="partial_snapshots"
                  class="filled-in checkbox-ha" onchange="toggleSlide(this, 'settings_partial_details');" />
                <span>Partial Snapshots</span>
                <br />
                <span class="helper-text">Partial snapshots allow you to selectively backup portions of your Home
                  Assistant configuration,
                  folder, and add-ons. Choose which parts of Home Assistant you'd like included in snapshots below.
                  New add-ons will be automatically included in snapshots unless you update these settings to
                  exclude them.</span>
              </label>
            </div>
          </div>
          <div class="row" id="settings_partial_details" style="display: none">
            <div class="col s11 offset-s1">
              <div class="row" style="margin-bottom: 0px">
                <div class="col s12">
                  <span style="font-weight: bold">Folders</span>
                  <ul>
                    <li class="indented-li">
                      <label>
                        <input class="filled-in settings_folder_checkbox" settings_ignore="true" type="checkbox"
                          name="folder_homeassistant" id="folder_homeassistant" checked />
                        <span class="checkbox-label">Home Assistant Configuration</span>
                        <br />
                        <span class="helper-text">Backup the files and folders from your Home Assistant config
                          directory, eg configuration.yaml</span>
                      </label>
                    </li>
                    <li class="indented-li">
                      <label class="checkbox-label">
                        <input class="filled-in settings_folder_checkbox" settings_ignore="true" type="checkbox"
                          name="folder_ssl" id="folder_ssl" checked />
                        <span class="checkbox-label">SSL</span>
                        <br />
                        <span class="helper-text">Backup your "/ssl" directory, where your certfile and keyfile
                          are typically stored.</span>
                      </label>
                    </li>
                    <li class="indented-li">
                      <label class="checkbox-label">
                        <input class="filled-in settings_folder_checkbox" settings_ignore="true" type="checkbox"
                          name="folder_share" id="folder_share" checked />
                        <span class="checkbox-label">Share</span>
                        <br />
                        <span class="helper-text">Backup your "/share" directory.</span>
                      </label>
                    </li>
                    <li class="indented-li">
                      <label class="checkbox-label">
                        <input class="filled-in settings_folder_checkbox" settings_ignore="true" type="checkbox"
                          name="folder_addons" id="folder_addons" checked />
                        <span class="checkbox-label">Local Addons</span>
                        <br />
                        <span class="helper-text">Backup your local addons directory. This directory will be empty
                          unless you use it for add-on development.</span>
                      </label>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="row">
                <div class="col s12">
                  <span style="font-weight: bold;">Addons</span>
                  <ul id="settings_addons">

                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <span style="font-size: 15px;">Look and Feel</span>
                <br />
                <span class="helper-text">Configure how this web UI looks</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col s11 offset-s1 row">
              <div class="row">
                <div class="input-field col s6">
                  <i class="material-icons prefix">format_paint</i>
                  <a href="#!" class="waves-effect waves-light btn-flat" style="margin-left: 45px; margin-top: 10px"
                    onclick="showPallette(this)" id="background_color"></a>
                  <label style="transform: translateY(-20px) scale(0.8)">Background Color</label>
                  <span class="helper-text" style="margin-top: 10px">The background color of this interface. <a href="#"
                      onclick="revertColors();">Click here</a> to revert back to the default.</span>
                </div>
                <div class="input-field col s6">
                  <i class="material-icons prefix">format_paint</i>
                  <a href="#!" class="waves-effect waves-light btn-flat" style="margin-left: 45px; margin-top: 10px"
                    onclick="showPallette(this)" id="accent_color"></a>
                  <label style="transform: translateY(-20px) scale(0.8)">Accent Color</label>
                  <span class="helper-text" style="margin-top: 10px">The accent color of this interface (eg links,
                    buttons, and other elements you can interact with). <a href="#" onclick="revertColors();">Click
                      here</a> to revert back to the default.</span>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col s12">
              <label>
                <span style="font-size: 15px;">Networking Options</span>
                <br />
                <span class="helper-text">Configure timeouts and other options about how the add-on reaches Google
                  Drive</span>
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col s11 offset-s1 row">
              <div class="input-field col m6 s12">
                <i class="material-icons prefix">timelapse</i>
                <input type="number" id="google_drive_timeout_seconds" name="google_drive_timeout_seconds" min="1"
                  class="validate" />
                <label for="google_drive_timeout_seconds">Google Drive Timeout</label>
                <span class="helper-text">The number of seconds the add-on should wait when connecting to or reading
                  from Google Drive's servers.</span>
              </div>
              <div class="input-field col m6 s12">
                <i class="material-icons prefix">cloud</i>
                <input type="text" id="alternate_dns_servers" name="alternate_dns_servers"
                  pattern="^([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})(,[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})*$"
                  class="validate" />
                <label for="alternate_dns_servers">Alternate DNS Servers</label>
                <span class="helper-text">When the add-on runs into trouble resolving Google Drive's IP Address, it will
                  use this comma-delimited list of DNS Servers as alternate sources for name resolution. The servers
                  must support TCP DNS lookups. The defaults are <a
                    href="https://developers.google.com/speed/public-dns/" target="_blank">Google's public DNS
                    servers</a>.</span>
              </div>
            </div>
            <div class="col s11 offset-s1 row">
              <div class="col m12 s12">
                <label>
                  <input type="checkbox" name="ignore_ipv6_addresses" id="ignore_ipv6_addresses"
                    class="filled-in checkbox-ha" />
                  <span>Ignore IPv6 Addresses</span>
                  <br />
                  <span class="helper-text">Ignore ipv6 Addresses for the purposes or DNS resolution. Some users have
                    had problems attempting to connect to Googles IPv6 servers because it is disabled on their
                    network.</span>
                </label>
              </div>
            </div>
            <div class="col s11 offset-s1 row">
              <div class="input-field col s12 m12 s12">
                <i class="material-icons prefix">cloud_queue</i>
                <input type="text" id="drive_ipv4" name="drive_ipv4"
                  pattern="^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$" class="validate" />
                <label for="drive_ipv4">Google Drive IP Address Override</label>
                <span class="helper-text">If you're having problems with reaching Google Drive, you can use this to
                  specify Google Drive's IP address manually and circumvent DNS lookup entirely. You can use a website
                  like <a target="_blank" href="https://www.xmyip.com/hostname-ip?hostname=www.googleapis.com">this
                    one</a> to lookup
                  what address will work for www.googleapis.com.</span>
              </div>
            </div>
            <div class="col s11 offset-s1 row">
              <div class="input-field col s12 m12 s12">
                <i class="material-icons prefix">refresh</i>
                <input type="text" id="max_sync_interval_seconds" name="max_sync_interval_seconds"
                  pattern="^([ ]*([0-9]*[.])?[0-9]+[ ]*(seconds|second|secs|sec|s|minutes|minute|mins|min|m|hours|hour|hr|h|days|day|d)?[ ,]*)*$" class="validate" />
                <label for="drive_ipv4">Sync Interval</label>
                <span class="helper-text">
                  How often the addon should check Home Assistant and Google Drive for snapshots.  
                  The addon will still sync more frequently when it starts, creates a new snapshot, 
                  or encounters errors.  This can be any duration of time expressed as hours, minutes,
                  and seconds.  Examples: '1 hour', '30 minutes', '1 hour, 30 minutes, 10 seconds', etc.</span>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="modal-footer" style="min-height: 56px; height: auto;">
      <div class="left valign-wrapper red darken-4 white-text default-hidden" id="settings_error_div"
        style="margin: 6px; padding-left: 16px; padding-right: 16px; min-height: 36px; vertical-align: middle">
        <span id="settings_error" style="vertical-align: middle;">
          Some configuration is invalid, check for red errors up above.
        </span>
      </div>

      <a href="#!" class="waves-effect waves-light btn-flat" id="save_settings" onClick="saveSettings()">Save</a>
      <a href="#!" class="waves-effect waves-light btn-flat" onclick="handleCloseSettings()" id="save_cancel">Cancel</a>
    </div>
  </div>
  <div id="help_modal" class="modal">
    <div class="modal-content">
      <h4> <i class="material-icons"
          style="font-size: 50px; padding-right: 10px; vertical-align: middle">help_outline</i><span>Get Help</span>
      </h4>
      <p class="detail-node">
        Maybe this add-on isn't working or you just don't know what to do. You can resolve almost any issue by
        following
        these steps:
      </p>
      <ul class="browser-default">
        <li>
          <h6>Check the FAQ</h6>First check out the <a
            href="https://github.com/sabeechen/hassio-google-drive-backup#faq">add-on FAQ</a>.
          Reading documentation is boring, its true, but the developer spent a lot of time trying making them easy to
          read and follow. If you're lucky, your question is already answered there.
        </li>

        <li>
          <h6>Check the Forum</h6>Next, try checking the <a
            href="https://community.home-assistant.io/t/hass-io-add-on-hass-io-google-drive-backup/">add-on
            announcement
            forum post.</a> Your question might already be there, and if not its a good place to ask. If the developer
          can't answer your question, it might be that another user can help.
        </li>
        <li>
          <h6>Check the Logs</h6>This add-on makes its <a target="_blank" href="log?format=view">debug logs</a>
          available. They're pretty cryptic, but might give you some context for whats going wrong. Sometimes, an
          error
          only shows up in the Home Assistant supervisor logs, which you can get to from within Home Assistant by
          clicking "Supervisor" > "System" > "System Logs" > "Refresh".
        </li>
        <li>
          <h6>Restart Everything</h6>
          Restart the add-on. Restart Home Assistant. Reinstall the add-on. Technology loves to be restarted, its
          amazing how many problems it can solve.
        </li>
        <li>
          <h6>File an Issue</h6>If you don't want to ask something in front of the angry mobs on the internet, you can
          file an issue on the
          project GitHub <a onclick="bugReport()">Issue Tracker</a>,
          just click "new issue". The developer gets an email if make one of those, which he promises to try and help
          with. No question is stupid.
        </li>
        <li>
          <h6>Reach out Directly</h6>I put my name on this and I want it to work well for you. You can email me at <a
            href="mailto:stephen@beechens.com">stephen@beechens.com</a>
        </li>
      </ul>
      <p>Maybe what you're dealing with is of a more, <i>general</i> nature? Home Assistant has a lot of rough edges,
        but really anything can be frustrating.</p>
      <ul class="browser-default">
        <li>
          <h6>Take care of yourself</h6>
          Make sure you've had enough water to drink today. If you love coffee, it might be time to put on a new pot.
          If
          its late at night, now might be the time to hit the sack. Everything is more difficult when you're not at
          your
          best.
        </li>
        <li>
          <h6>Get a fresh perspective</h6>
          Take a walk, serously. Sometimes the mind gets so fixated on a problem that it can't think around it
          anymore.
          <a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">Explain your problem to a duck</a> and you
          might see the solution was obvious.
        </li>
        <li>
          <h6>Be realistic</h6>
          In a week you're unlikely to even remember this moment. Next year, you're going to be a different person,
          with
          a different mind. If you have the spare time to get frustrated at how your home automation system stores its
          backups, then whatever you've got going on in this moment is probably small potates. You've always been the
          one to decide how you react.
        </li>
      </ul>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-light btn-flat">That Helps</a>
      <a href="#!" class="modal-close waves-effect waves-light btn-flat">Nevermind</a>
    </div>
  </div>
  <div id="bug_modal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4> <i class="material-icons"
          style="font-size: 50px; padding-right: 10px; vertical-align: middle">bug_report</i><span>Report an Issue</span>
      </h4>
      <p class="detail-node">
        Looks like you ran into a problem that you want to report to the developer(s).  Getting a lot of detail about what you 
        ran into can really help them figure things out.  To make gathering that easy for you and the developer, follow these instructions:
        <ul class="browser-default">
          <li>Click <a href="#!" onclick="doBugDetailCopy()"><i style="vertical-align: middle;" class="material-icons">content_copy</i>Copy Details</a> to copy the details below to your clipboard.  This includes detail about your configuration, 
            any errors the addon found, and logs from Home Assistant, the Supervisor, and the addon.  This information will be
            very helpful to the developer who looks at your issue.</li>
          <li>Click <a target="_blank" href="https://github.com/sabeechen/hassio-google-drive-backup/issues/new?title=Please%20add%20a%20title&body=Copy%20the%20info%20from%20the%20previous%20page%20here"><i style="vertical-align: middle;" class="material-icons">open_in_new</i>Open Github</a>
             to open a new issue on Github and paste the text you copied there.  You can click "Preview" to make sure it looks right.</li>
          <li>Before submitting the issue, add in any information you think might help.  Consider including what you were doing that caused the error, a screenshot, etc.</li>
          <li>Click "Submit new issue" on Github to post the issue.  The developer will get back to you as fast as he can, but keep in mind that he maintains this project in his free time.</li>
        </ul>
      </p>
      <p>Here is a preview of the information you'll be providing:</p>
      <div class="row">
        <div class="col s12">
          <ul class="tabs" id="bug_report_tabs">
            <li class="tab col s3"><a class="active" href="#bug_preview">Preview</a></li>
            <li class="tab col s3"><a href="#bug_markdown">Markdown</a></li>
          </ul>
        </div>
        <div id="bug_preview" class="col s12">
          <div id="bug_preview_display" class="highlight-border" style="overflow-y: scroll; overflow-x: scroll;"></div>
        </div>
        <div id="bug_markdown" class="col s12">
          <div class="highlight-border">
            <textarea id="bug_markdown_display" style="overflow-x: scroll; height: 1000px"></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="copy_button" onclick="doBugDetailCopy()" class="btn waves-effect waves-light btn-flat"><i class="material-icons" style="vertical-align: middle; padding-right: 5px;">content_copy</i>Copy Details</button>
      <a target="_blank" href="https://github.com/sabeechen/hassio-google-drive-backup/issues/new?title=Please%20add%20a%20title&body=Copy%20the%20info%20from%20the%20previous%20page%20here" class="waves-effect waves-light btn-flat"><i class="material-icons" style="vertical-align: middle; padding-right: 5px;">open_in_new</i>Open Github</a>
      <a href="#!" class="modal-close waves-effect waves-light btn-flat">Close</a>
    </div>
  </div>
  <header>
    <nav class="non-ingress ha-blue" role="navigation">
      <div class="nav-wrapper">
        <a class="brand-logo"> <img style="vertical-align: middle;" src="static/images/logo.png" width=40 height=40 />
          <span>Home Assistant Google Drive Backup</span>
        </a>
        <a href="#" data-target="mobile-menu" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down">
          <li>
            <a href="#!" onClick="loadSettings()">
              <i class="material-icons"
                style="display: inline; margin-right: 5px; vertical-align: bottom">settings</i>Settings
            </a>
          </li>
          <li>
            <a href="/log?format=view" target="_blank">
              <i class="material-icons" style="display: inline; margin-right: 5px; vertical-align: bottom">code</i>Logs
            </a>
          </li>
          <li>
            <a href="#!" class="modal-trigger" data-target="help_modal">
              <i class="material-icons" style="display: inline; margin-right: 5px; vertical-align: bottom">help</i>Get
              Help
            </a>
          </li>
          <li>
            <a onclick="bugReport()">
              <i class="material-icons" style="display: inline; margin-right: 5px; vertical-align: bottom">bug_report</i>Report a bug
            </a>
          </li>
        </ul>
      </div>
    </nav>
    <ul class="sidenav non-ingress" id="mobile-menu">
      <li><a href="#!" onClick="loadSettings()"><i class="material-icons">settings</i>Settings</a></li>
      <li><a href="/log?format=view" target="_blank"><i class="material-icons">code</i>Logs</a></li>
      <li><a href="#!" data-target="help_modal" class="modal-trigger"><i class="material-icons">help</i>Get Help</a></li>
      <li><a onclick="bugReport()"><i class="material-icons">bug_report</i>Report a bug</a></li>
    </ul>
    <div>

    </div>
    <div class="ingress-only ha-blue" style="width: 100%; height: 40px;">
      <a href="#!" class="left btn waves-effect top-btn modal-trigger" data-target="help_modal">
        <i class="material-icons" style="display: inline; margin-right: 5px">help</i>
        <span style="vertical-align: top;">Get Help</span>
      </a>
      <a href="log?format=view" target="_blank" class="left btn waves-effect top-btn">
        <i class="material-icons" style="display: inline; margin-right: 5px">code</i>
        <span style="vertical-align: top;">Logs</span>
      </a>
      <a href="#!" onClick="loadSettings()" class="left waves-effect btn top-btn">
        <i class="material-icons" style="display: inline; margin-right: 5px">settings</i>
        <span style="vertical-align: top;">Settings</span>
      </a>
    </div>
  </header>
  <main>
    <div class="section no-pad-bot" id="index-banner">
      <div class="container">
        <br><br>
        <h1 class="header center">Get Started</h1>
        <div class="row center">
          <h5 class="header col s12 light">To begin, this add-on will need access to your Google Drive&trade;.
            <span id="flavor_auto_folder">On your first backup it will create a new folder at the root of your <a
                href="https://drive.google.com/drive/my-drive">My Drive</a> where future backups will be stored. Once
              its created, you can move the folder wherever you want.</span>
            <span id="flavor_specific_folder">After connecting with Google Drive, you'll be prompted to select your
              backup folder.</span>
          </h5>
        </div>
        <div>

        </div>
        <div class="row center">
          <div class="col m12 l6 offset-l3">
            <h6 id="what_do_next_now_please" style="display: none;" class="header light">
              <span id="what_do_next_now_please_text"></span>
              Change your <a href="#!" onclick="loadSettings()"><i class="material-icons"
                  style="display: inline; margin-right: 2px; vertical-align: middle; font-size: 15px">settings</i>settings</a>
              to alter the add-on's behavior if that isn't what you want.
            </h6>
          </div>
        </div>
        <div class="row center">
          <div id="option1" class="col m12 l6 offset-l3 center center-align">
            <a target="_blank" id="authenticate-button" style="margin: 10px"
              class="btn-large waves-effect waves-light btn ha-blue">Authenticate
              with Google Drive</a>
            <div class="row center">
              <div class="col s12">
                <ul>
                  <li>
                    <h6 class="header col s12 light">
                      Clicking this link authenticates you with an external domain (<a
                        href="https://habackup.io">habackup.io</a>). To learn why
                      this is necessary, check out the details <a
                        href="https://github.com/sabeechen/hassio-google-drive-backup/blob/master/hassio-google-drive-backup/AUTHENTICATION.md">here</a>.
                      By doing this, you agree to our <a href="pp">Privacy Policy</a> and <a href="tos">Terms of
                        Service</a></h6>
                  </li>
                  <li>
                    <h6 class="header col s12 light">*Note: this will <i>only</i> have access to the files and folders
                      it
                      creates.
                      The Add-on can't see any of the other files you've added to Google Drive.</h6>
                  </li>
                </ul>
              </div>
            </div>
            <br />
            Having trouble with this or looking to generate your own credentials without going through an external
            domain?
            <a href="#" onclick="$('#option2').show();$('#option1').hide();">Click here.</a>

          </div>
          <div id="option2" class="col s12 m6 offset-m3 default-hidden">
            Follow the <a target="_blank"
              href="https://github.com/sabeechen/hassio-google-drive-backup/blob/master/LOCAL_AUTH.md">instructions
              here</a> to get your own client ID and client secret from Google. This is a much more complicated and time
            consuming approach, but doesn't require you to authenticate yourself with an external domain.
            <br />
            <a href="#" onclick="$('#option2').hide();$('#option1').show();">&lt; Go back to the easier way</a>
            <div class="row">
              <form class="col s10" action="manualauth" method="get">
                <div class="row">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">vpn_key</i>
                    <input id="client_id" name="client_id" type="text" class="validate" />
                    <label for="client_id">Client ID</label>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">vpn_key</i>
                    <input id="client_secret" name="client_secret" type="text" class="validate" />
                    <label for="client_secret">Client Secret</label>
                  </div>
                </div>
                <div class=row>
                  <div class="input-field col s12">
                    <a target="_blank" class="right btn-large waves-effect waves-light ha-blue btn disabled"
                      id="secret_button" onclick="getAuthUrl()">Connect</a>
                  </div>
                </div>
              </form>
              <div class=row>
                <div class="col s12" id="help_text" style="display: none">
                  <p>
                    Click "Connect" once you have a client ID and client secret. This will redirect you to Google's
                    authentications servers where you you will be given an authentication code that you can enter below
                    to finish authorization.
                  </p>
                </div>
              </div>
              <div class="row" style="display: none" id="code_form">
                <div class="col s12">
                  <form class="col s10" action="manualauth" method="get">
                    <div class="row">
                      <div class="input-field col s12">
                        <i class="material-icons prefix">vpn_key</i>
                        <input id="code" name="code" type="text" class="validate disabled">
                        <label for="code">Code from Google</label>
                      </div>
                    </div>
                    <div class=row>
                      <div class="col s12">
                        <a target="_blank" class="right btn-large waves-effect waves-light btn ha-blue disabled"
                          id="manualauthbutton" onClick="submitCode()">Authorize</a>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <br><br>
      </div>
    </div>


    <div class="container">
      <div class="section">

        <div class="row">
        </div>

      </div>
      <br><br>
    </div>
  </main>
  <footer class="ha-blue page-footer">
    <div class="container">
      <div class="row">
        <div class="col l3 s12">
          <h5 class="accent-text">Connect</h5>
          <ul>
            <li><a class="accent-text" href="https://github.com/sabeechen/hassio-google-drive-backup">Project Github</a>
            </li>
            <li><a class="accent-text" href="https://github.com/sabeechen/hassio-google-drive-backup/issues">Issue
                Tracker</a></li>
            <li><a class="accent-text" href="https://materializecss.com">Materialize</a></li>
          </ul>
        </div>
        <div class="col l6 s12">
          <h5 class="accent-title">Who did this?</h5>
          <p class="accent-text">I'm an individual who works on projects like this in my spare time. If you
            like it and would like to support me, you can star my projects on <a
              href="https://github.com/sabeechen" class="accent-text">Github</a> or just gimme money at
            <a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/sabeechen"><img src="static/images/bmc.svg" alt="Support me"><span>Buy me a coffee</span></a></p>
        </div>
      </div>
      <div class="container left accent-text">
        © 2020 Stephen Beechen
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script type="text/javascript">
    document.getElementById("authenticate-button").href =
      "https://habackup.io/drive/authorize?redirectbacktoken=" + encodeURIComponent(getWindowRootUri() + "token");

    function submitCode() {
      var code = $("#code").val();
      if (!code || code.length == 0) {
        M.toast({ html: "Please enter the code you got form Google by clicking \"connect\" above" })
      }
      var url = "manualauth?code=" + code;
      $.get(url,
        function (data) {
          M.toast({ html: "Submitting authorization code..." })
          if (data.hasOwnProperty("auth_url")) {
            console.log("Redirecting to " + data.auth_url)
            window.location = data.auth_url
          } else if (data.hasOwnProperty("error")) {
            M.toast({ html: data.error })
          }
        }, "json")
    }

    function updateHref() {
      var client_id = $("#client_id").val();
      var client_secret = $("#client_secret").val();
      if (client_id && client_id.length > 0 && client_secret && client_secret.length > 0) {
        $("#secret_button").removeClass('disabled');
        $("#help_text").fadeIn(400)
        $("#code_form").fadeIn(400)
      } else {
        $("#secret_button").addClass('disabled');
      }
    }

    $(document).ready(function () {
      // Needed to make modal dialogs work.
      $('.modal').modal();
      $("#client_id").change(updateHref);
      $("#client_secret").change(updateHref);
      $("#client_secret").keyup(updateHref);
      $("#client_id").keyup(updateHref);
      $("#client_secret").mouseup(updateHref);
      $("#client_id").mouseup(updateHref);

      window.setInterval(reloadForNewCreds, 5000);
      reloadForNewCreds();
    });

    function getAuthUrl() {
      var client_id = $("#client_id").val();
      var client_secret = $("#client_secret").val();
      if (!(client_id && client_id.length > 0 && client_secret && client_secret.length > 0)) {
        M.toast({ html: "Please enter a Client Id and Client Secret first" })
      }
      var url = "manualauth?client_id=" + client_id + "&client_secret=" + client_secret;
      console.log("Requesting auth url from " + url);
      $.get(url,
        function (data) {
          M.toast({ html: "Requesting authorization URL..." })
          if (data.hasOwnProperty("auth_url")) {
            console.log("Opening window to " + data.auth_url)
            window.open(data.auth_url);
            $("#code").removeClass("disabled")
            $("#manualauthbutton").removeClass("disabled")
          } else if (data.hasOwnProperty("error")) {
            M.toast({ html: data.error })

            $("#code").addClass("disabled")
            $("#manualauthbutton").addClass("disabled")
          }
        }, "json")
    }

  </script>
</body>

</html>